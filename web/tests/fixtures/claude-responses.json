{
  "valid_unsafe": {
    "input": "{\"verdict\": \"unsafe\", \"flagged_ingredients\": [\"wheat flour\"], \"allergen_warnings\": [], \"explanation\": \"Contains wheat\", \"confidence\": \"high\"}",
    "expected": {
      "verdict": "unsafe",
      "flagged_ingredients": ["wheat flour"],
      "allergen_warnings": [],
      "explanation": "Contains wheat",
      "confidence": "high",
      "mode": "label"
    }
  },
  "valid_safe": {
    "input": "{\"verdict\": \"safe\", \"flagged_ingredients\": [], \"allergen_warnings\": [], \"explanation\": \"No gluten found\", \"confidence\": \"high\"}",
    "expected": {
      "verdict": "safe",
      "flagged_ingredients": [],
      "allergen_warnings": [],
      "explanation": "No gluten found",
      "confidence": "high",
      "mode": "label"
    }
  },
  "valid_with_surrounding_text": {
    "input": "Here's my analysis:\n{\"verdict\": \"safe\", \"flagged_ingredients\": [], \"allergen_warnings\": [], \"explanation\": \"No gluten found\", \"confidence\": \"high\"}\nLet me know if you need more.",
    "expected": {
      "verdict": "safe",
      "flagged_ingredients": [],
      "allergen_warnings": [],
      "explanation": "No gluten found",
      "confidence": "high",
      "mode": "label"
    }
  },
  "missing_optional_fields": {
    "input": "{\"verdict\": \"caution\"}",
    "expected": {
      "verdict": "caution",
      "flagged_ingredients": [],
      "allergen_warnings": [],
      "explanation": "",
      "confidence": "medium",
      "mode": "label"
    }
  },
  "invalid_verdict_value": {
    "input": "{\"verdict\": \"maybe\", \"flagged_ingredients\": [], \"explanation\": \"Not sure\"}",
    "expected": {
      "verdict": "caution",
      "flagged_ingredients": [],
      "allergen_warnings": [],
      "explanation": "Unable to fully analyze the ingredients. Please review manually.",
      "confidence": "low"
    }
  },
  "no_json_found": {
    "input": "I could not analyze this image properly.",
    "expected": {
      "verdict": "caution",
      "flagged_ingredients": [],
      "allergen_warnings": [],
      "explanation": "Unable to fully analyze the ingredients. Please review manually.",
      "confidence": "low"
    }
  },
  "malformed_json": {
    "input": "{\"verdict\": \"safe\", flagged_ingredients: [broken",
    "expected": {
      "verdict": "caution",
      "flagged_ingredients": [],
      "allergen_warnings": [],
      "explanation": "Unable to fully analyze the ingredients. Please review manually.",
      "confidence": "low"
    }
  },
  "empty_response": {
    "input": "",
    "expected": {
      "verdict": "caution",
      "flagged_ingredients": [],
      "allergen_warnings": [],
      "explanation": "Unable to fully analyze the ingredients. Please review manually.",
      "confidence": "low"
    }
  },
  "valid_menu_response": {
    "input": "{\"mode\": \"menu\", \"verdict\": \"caution\", \"menu_items\": [{\"name\": \"Grilled Salmon\", \"verdict\": \"safe\", \"notes\": \"No gluten ingredients listed\"}, {\"name\": \"Garden Salad\", \"verdict\": \"safe\", \"notes\": \"Safe without croutons\"}, {\"name\": \"Grilled Chicken\", \"verdict\": \"safe\", \"notes\": \"Appears gluten-free as described\"}, {\"name\": \"Caesar Salad\", \"verdict\": \"caution\", \"notes\": \"Has croutons (wheat) — ask to remove. Check the dressing too.\"}, {\"name\": \"Pasta Bolognese\", \"verdict\": \"unsafe\", \"notes\": \"Contains wheat pasta\"}, {\"name\": \"Fish & Chips\", \"verdict\": \"unsafe\", \"notes\": \"Battered with wheat flour\"}], \"flagged_ingredients\": [], \"allergen_warnings\": [\"Menu does not list full ingredients — ask your server about specific dishes\"], \"explanation\": \"3 items look safe, 1 needs a modification, and 2 are unsafe.\", \"confidence\": \"medium\"}",
    "expected": {
      "mode": "menu",
      "verdict": "caution",
      "menu_items": [
        { "name": "Grilled Salmon", "verdict": "safe", "notes": "No gluten ingredients listed" },
        { "name": "Garden Salad", "verdict": "safe", "notes": "Safe without croutons" },
        { "name": "Grilled Chicken", "verdict": "safe", "notes": "Appears gluten-free as described" },
        { "name": "Caesar Salad", "verdict": "caution", "notes": "Has croutons (wheat) — ask to remove. Check the dressing too." },
        { "name": "Pasta Bolognese", "verdict": "unsafe", "notes": "Contains wheat pasta" },
        { "name": "Fish & Chips", "verdict": "unsafe", "notes": "Battered with wheat flour" }
      ],
      "flagged_ingredients": [],
      "allergen_warnings": ["Menu does not list full ingredients — ask your server about specific dishes"],
      "explanation": "3 items look safe, 1 needs a modification, and 2 are unsafe.",
      "confidence": "medium"
    }
  },
  "menu_with_capitalized_mode": {
    "input": "{\"mode\": \"Menu\", \"verdict\": \"caution\", \"menu_items\": [{\"name\": \"Salad\", \"verdict\": \"safe\", \"notes\": \"No gluten ingredients listed\"}], \"flagged_ingredients\": [], \"allergen_warnings\": [\"Menu does not list full ingredients — ask your server about specific dishes\"], \"explanation\": \"1 item looks safe.\", \"confidence\": \"medium\"}",
    "expected": {
      "mode": "menu",
      "verdict": "caution",
      "menu_items": [
        { "name": "Salad", "verdict": "safe", "notes": "No gluten ingredients listed" }
      ],
      "flagged_ingredients": [],
      "allergen_warnings": ["Menu does not list full ingredients — ask your server about specific dishes"],
      "explanation": "1 item looks safe.",
      "confidence": "medium"
    }
  },
  "menu_with_invalid_items": {
    "input": "{\"mode\": \"menu\", \"verdict\": \"caution\", \"menu_items\": [{\"name\": \"Good Item\", \"verdict\": \"safe\", \"notes\": \"OK\"}, {\"name\": \"Bad Item\", \"verdict\": \"invalid\", \"notes\": \"Should be normalized to caution\"}, {\"verdict\": \"safe\", \"notes\": \"Missing name\"}], \"flagged_ingredients\": [], \"allergen_warnings\": [], \"explanation\": \"Test\", \"confidence\": \"medium\"}",
    "expected": {
      "mode": "menu",
      "verdict": "caution",
      "menu_items": [
        { "name": "Good Item", "verdict": "safe", "notes": "OK" },
        { "name": "Bad Item", "verdict": "caution", "notes": "Should be normalized to caution" }
      ],
      "flagged_ingredients": [],
      "allergen_warnings": [],
      "explanation": "Test",
      "confidence": "medium"
    }
  },
  "spanish_label_unsafe": {
    "input": "{\"verdict\": \"unsafe\", \"detected_language\": \"es\", \"flagged_ingredients\": [\"harina de trigo (wheat flour)\", \"cebada (barley)\"], \"allergen_warnings\": [\"Contiene gluten (Contains gluten)\"], \"explanation\": \"This product contains wheat flour and barley, both of which contain gluten.\", \"confidence\": \"high\", \"mode\": \"label\"}",
    "expected": {
      "verdict": "unsafe",
      "detected_language": "es",
      "flagged_ingredients": ["harina de trigo (wheat flour)", "cebada (barley)"],
      "allergen_warnings": ["Contiene gluten (Contains gluten)"],
      "explanation": "This product contains wheat flour and barley, both of which contain gluten.",
      "confidence": "high",
      "mode": "label"
    }
  },
  "spanish_label_safe": {
    "input": "{\"verdict\": \"safe\", \"detected_language\": \"es\", \"flagged_ingredients\": [], \"allergen_warnings\": [], \"explanation\": \"Good news! This product's ingredients are all gluten-free. The label is in Spanish — all ingredients checked out safe.\", \"confidence\": \"high\", \"mode\": \"label\"}",
    "expected": {
      "verdict": "safe",
      "detected_language": "es",
      "flagged_ingredients": [],
      "allergen_warnings": [],
      "explanation": "Good news! This product's ingredients are all gluten-free. The label is in Spanish — all ingredients checked out safe.",
      "confidence": "high",
      "mode": "label"
    }
  },
  "spanish_menu_response": {
    "input": "{\"mode\": \"menu\", \"detected_language\": \"es\", \"verdict\": \"caution\", \"menu_items\": [{\"name\": \"Ensalada Mixta\", \"verdict\": \"safe\", \"notes\": \"Mixed salad — no gluten ingredients listed\"}, {\"name\": \"Paella de Mariscos\", \"verdict\": \"safe\", \"notes\": \"Seafood rice dish — naturally gluten-free\"}, {\"name\": \"Croquetas de Jamón\", \"verdict\": \"unsafe\", \"notes\": \"Croquettes are made with béchamel (flour-based)\"}, {\"name\": \"Pan con Tomate\", \"verdict\": \"unsafe\", \"notes\": \"Bread with tomato — contains wheat bread\"}], \"flagged_ingredients\": [], \"allergen_warnings\": [\"Menu does not list full ingredients — ask your server (pregunta al camarero)\"], \"explanation\": \"2 items look safe and 2 are unsafe.\", \"confidence\": \"medium\"}",
    "expected": {
      "mode": "menu",
      "detected_language": "es",
      "verdict": "caution",
      "menu_items": [
        { "name": "Ensalada Mixta", "verdict": "safe", "notes": "Mixed salad — no gluten ingredients listed" },
        { "name": "Paella de Mariscos", "verdict": "safe", "notes": "Seafood rice dish — naturally gluten-free" },
        { "name": "Croquetas de Jamón", "verdict": "unsafe", "notes": "Croquettes are made with béchamel (flour-based)" },
        { "name": "Pan con Tomate", "verdict": "unsafe", "notes": "Bread with tomato — contains wheat bread" }
      ],
      "flagged_ingredients": [],
      "allergen_warnings": ["Menu does not list full ingredients — ask your server (pregunta al camarero)"],
      "explanation": "2 items look safe and 2 are unsafe.",
      "confidence": "medium"
    }
  },
  "english_label_no_language": {
    "input": "{\"verdict\": \"safe\", \"flagged_ingredients\": [], \"allergen_warnings\": [], \"explanation\": \"No gluten found\", \"confidence\": \"high\"}",
    "expected": {
      "verdict": "safe",
      "flagged_ingredients": [],
      "allergen_warnings": [],
      "explanation": "No gluten found",
      "confidence": "high",
      "mode": "label"
    }
  }
}
